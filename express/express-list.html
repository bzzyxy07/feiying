<form class="layui-form filter-form" url="/api/OrderTransportOrder/OrderListMy" id="express_info_search_form">

	<ul>
		<li>
			<span>运单状态</span>
			<ul class="form-condition auto-click-condition">
				<li class="active" data-value="" click-name="">全部</li>
				<li data-value="false" click-name="isenter">待处理</li>
				<li data-value="false" click-name="ispay">待付款</li>
				<li data-value="false" click-name="isdeliver">待发货</li>
				<li data-value="true" click-name="isdeliver">已发货</li>
			</ul>
		</li>
		<li>
			<span>来源</span>
			<ul class="form-condition" name="">
				<li class="active" data-value="">全部</li>
				<li data-value="">转运</li>
				<li data-value="">快递</li>
			</ul>
		</li>

	</ul>
	<ul>
		<li>
			<span>送达仓库</span>
			<select name="depotid" initial-name="depotlist"></select>
		</li>
		<li>
			<span>线路名称</span>
			<select name="routeid" initial-name=""></select>
		</li>

		<li>
			<span>运单号</span>
			<input class="layui-input form-input" placeholder="请输入运单号" name="cnum">
		</li>
		<li>
			<span>发货批次</span>
			<select name="routeid" initial-name=""></select>
		</li>
		<li>
			<button type="button" class="layui-btn layui-btn-sm layui-btn-normal filter-btn">查询</button>
			<button type="reset" class="layui-btn layui-btn-sm layui-btn-primary">重置</button>
			<button type="button" class="layui-btn layui-btn-sm"><i class="fa fa-print"></i>批量打印运单</button>
			<button type="button" class="layui-btn layui-btn-sm"><i class="fa fa-download"></i>导出excel表格</button>
		</li>
	</ul>
</form>
<div class="data-table-container">
	<table id="express_info_table" lay-filter="express-info-table"></table>
</div>
<script>
	layui.use(['layer', 'form', 'table'], function() {
		var form = layui.form;
		var layer = layui.layer;
		var table = layui.table;
		comm.bindFilterForm({
			formId: "express_info_search_form",
			renderTable: {
				elem: '#express_info_table',
				cols: [
					[{
						checkbox: true
					}, {
						field: 'trackingnumber',
						title: '来源',
						sort: true,
					}, {
						field: 'depotname',
						title: '运单号',
						sort: true,
					}, {
						field: 'route_name',
						title: '线路',
						sort: true,
					}, {
						field: 'depot_name',
						title: '仓库',
						sort: true,
					}, {
						field: 'weight',
						title: '重量(磅)',
						width: 120,
						sort: true,
					}, {
						field: 'total_price',
						title: '总计（$）',
					}, {
						field: 'deliver_name',
						title: '发件人',
						sort: true,
					}, {
						field: 'receiver_name',
						title: '收件人',
						sort: true,
					}, {
						field: 'id_card_info',
						title: '身份证信息',
						sort: true,
					}, {
						field: 'expressdetails',
						title: '发货批次',
					}, {
						field: 'transport_status',
						title: '运输状态',
						sort: true,
					}, {
						field: '',
						title: '操作',
						toolbar: '#operation',
						width: 400,
						fixed: 'right'
					}]
				]
			}
		});

		table.on('tool(express-info-table)', function(obj) {
			var data = obj.data;
			var layEvent = obj.event;
			var tr = obj.tr;

			if(layEvent === 'detail') { //查看运单详情
				comm.openPage({
					url: './express/express-detail.html?id=' + data.id,
					open: {
						maxmin: true,
						area: ['80%', '600px'],
					}
				});
			} else if(layEvent === 'print-rm' || layEvent === 'print-A4') { //热敏 400 打印A4打印 790
				comm.getDataByCondition({
					loading: true,
					ajax: {
						url: '/api/OrderTransportOrder/Details?modelId=' + data.id,
						success: function(data) {
							sessionStorage.setItem("printData", data);
							var pageUrl = (layEvent === 'print-A4') ? './print/print-A4-page.html' : './print/print-rm-page.html';
							var width = (layEvent === 'print-A4') ? '820px' : '440px';
							layer.open({
								type: 2,
								title: '运单打印',
								shadeClose: true,
								//								shade: false,
								//								maxmin: true,
								area: [width, '600px'],
								content: pageUrl
							});
						}
					}
				});
			} else if(layEvent === 'edit') { //编辑运单信息
				console.info(1)
				comm.openPage({
					url: './express/express-edit.html',
					data: data,
					open: {
						maxmin: true,
						area: ['80%', '80%'],
					}
				});
			} else if(layEvent === 'delete') { //删除运单信息
				//              接口/api/OrderTransportOrder/Handle
				console.info(data);
			} else if(layEvent === 'track') { //运单追踪
				
				comm.getDataByCondition({
					loading: true,
					ajax: {
						url: '/api/OrderProcessStatusChange/Changes?elementid=' + data.id,
						success: function(rlt) {
							rlt = rlt["Data"];
							if (!rlt.length) layer.msg("尚无追踪信息");
//							console.info(data);
//							comm.openPage({
//								url: './express/express-track.html',
//								data: data['Data'],
//								open: {
//									maxmin: true,
//									area: ['80%', '80%'],
//								}
//							});
						}
					}
				});
			}
		});
	});
</script>
<script type="text/html" id="operation">
	<a class="layui-btn layui-btn-normal layui-btn-sm" lay-event="detail">详情</a>
	<a class="layui-btn layui-btn-danger layui-btn-sm" lay-event="track">追踪</a>
	<a class="layui-btn layui-bg-cyan layui-btn-sm" lay-event="edit">编辑</a>
	<a class="layui-btn layui-btn-primary layui-btn-sm" lay-event="delete">删除</a>
	<a class="layui-btn layui-btn-sm" lay-event="print-rm">热敏打印</a>
	<a class="layui-btn layui-btn-sm" lay-event="print-A4">A4打印</a>
</script>